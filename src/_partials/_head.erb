<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<% resource_title = resource.data.title || site.metadata.title %>
<title><%= resource_title %></title>

<meta name="description" content="<%= metadata.description %>" />
<link rel="modulepreload" href="<%= asset_path "javascript/index.js" %>">
<script data-turbo-track="reload" src="<%= asset_path "javascript/index.js" %>" async type="module"></script>

<!-- Deferred JS -->
<link rel="modulepreload" href="<%= asset_path "javascript/defer.js" %>">
<script data-turbo-track="reload" src="<%= asset_path "javascript/defer.js" %>" async type="module"></script>

<!-- Critical CSS -->
<link rel="stylesheet" data-turbo-track="reload" href="<%= asset_path "styles/main.css" %>" />

<!-- Deferred CSS -->
<!-- <link rel="preload" href="<%= asset_path "styles/defer.css" %>" as="style" onload="this.onload=null;this.rel='stylesheet'"> -->
<!-- <noscript><link rel="stylesheet" href="<%= asset_path "styles/defer.css" %>"></noscript> -->

<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ec4899">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- Social stuff -->
<%# <meta property="og:image" content="https://mrujs.com/images/mugshot.jpeg"> %>
<%# <meta property="twitter:card" content="summary_large_image"> %>
<%# <meta property="twitter:title" content="<%= resource_title %1>"> %>

<%= seo title=false %>
<%= feed_meta %>

  <style>
    .no-transitions {
      transition: none !important;
      animation: none !important;
    }
    .no-transitions * {
      transition: none !important;
      animation: none !important;
    }

    @media screen and (prefers-reduced-motion) {
      *, *:before, *:after {
        transition: none !important;
        animation: none !important;
      }
    }
  </style>


<script>
  function getTheme () {
    return localStorage.getItem('theme') || 'system';
  }

  function setTheme (theme) {
    localStorage.setItem('theme', theme);
  }

  function themeIsDark() {
    const theme = getTheme()
    if (theme === 'system') {
      return window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    return theme === 'dark';
  }

  function applyTheme(newTheme) {
    this.setTheme(newTheme)

    setTimeout(() => {
      ;[...document.querySelectorAll("[data-controller='theme-switcher'] sl-menu-item")].forEach((el) => {
        el.toggleAttribute("checked", el.getAttribute("value") === newTheme)
      })
    })


    // Toggle the dark mode class without transitions
    document.documentElement.classList.add("no-transitions");
    requestAnimationFrame(() => {
      const darkMode = themeIsDark()
      document.documentElement.classList.toggle("sl-theme-light", !darkMode)
      document.documentElement.classList.toggle("sl-theme-dark", darkMode)
      const ninjaKeys = document.querySelector("bridgetown-ninja-keys")
      if (ninjaKeys) {
        ninjaKeys.classList.toggle("dark", darkMode)
      }
      setTimeout(() => document.documentElement.classList.remove('no-transitions'));
    });
  }

  applyTheme(getTheme())
</script>
